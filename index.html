<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Cultural Coinage Name Generator — Sidebar Style</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- React (UMD) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <style>
    /* Sidebar-like compact UI inspired by your Sidebar repo.
       Clean, rounded, techy but warm: soft shadows, muted colors. */
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --muted:#9fb0c7;
      --accent:#60a5fa;
      --soft:#e6eef9;
      --card:#071022;
      --glass: rgba(255,255,255,0.03);
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{background: linear-gradient(180deg, #071025 0%, #071427 100%); color:var(--soft); display:flex; align-items:flex-start; justify-content:center; padding:28px;}
    .app {
      width: 940px;
      max-width: calc(100% - 40px);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: 14px;
      box-shadow: 0 12px 30px rgba(2,6,23,0.6);
      padding: 18px;
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 18px;
    }

    /* Left column: controls (sidebar-like). Right column: preview / results */
    .controls {
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      padding: 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.03);
      height: fit-content;
    }
    .hdr { display:flex; align-items:center; gap:12px; margin-bottom:12px; }
    .hdr-text h1 { font-size:16px; margin:0; }
    .logo {
      width:46px; height:46px; border-radius:10px; background:linear-gradient(135deg,#183b74,#2a6fb0); display:flex; align-items:center; justify-content:center; font-weight:700; color:white; font-size:20px;
      box-shadow: 0 6px 18px rgba(46,84,144,0.18);
    }
    p.desc{color:var(--muted); font-size:12px; margin-top:8px; margin-bottom:12px}

    .field { margin-bottom:10px; }
    label { display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    .tiny { font-size:11px; color:#9fb0c7; }

    select, input[type="text"], input[type="number"], input[type="password"], textarea {
      width:100%; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:var(--glass); color:var(--soft);
      outline:none; box-sizing: border-box;
    }
    .multi-checkbox { display:flex; flex-wrap:wrap; gap:8px; }
    .chip {
      padding:6px 10px; border-radius:999px; background:rgba(255,255,255,0.02); font-size:13px; cursor:pointer; border:1px solid rgba(255,255,255,0.02);
    }
    .chip.active { background: linear-gradient(90deg, rgba(96,165,250,0.18), rgba(96,165,250,0.10)); border-color: rgba(96,165,250,0.22); color:var(--soft); box-shadow:0 6px 18px rgba(38,99,156,0.08); }

    button.primary {
      width:100%; padding:10px; border-radius:10px; border:none; background:var(--accent); color:#04263b; font-weight:700; cursor:pointer; margin-top:6px;
      box-shadow: 0 8px 18px rgba(96,165,250,0.12);
    }
    button.primary:disabled { background: #555; color: #999; cursor: not-allowed;}
    button.ghost { background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--soft); padding:8px 12px; border-radius:8px; cursor:pointer; }
    
    .results {
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      padding:14px; border-radius:12px; border:1px solid rgba(255,255,255,0.03);
      min-height: 420px;
    }
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px; }
    .topbar-title { font-size:15px; font-weight:bold; }
    .topbar-count { color:var(--muted); font-size:13px; }
    
    .name-card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:10px; padding:12px; margin-bottom:10px; border:1px solid rgba(255,255,255,0.02); display:flex; justify-content:space-between; gap:16px;
    }
    .name-left { display:flex; flex-direction:column; gap:6px; }
    .name-title { font-weight:700; font-size:16px; color:var(--soft);}
    .name-score { margin-left:8px; }
    .name-sub { font-size:13px; color:var(--muted);}
    .name-right { display:flex; gap:8px; align-items:center; }
    .name-roots { font-size:12px; color:var(--muted); }

    .api-key-group { display:flex; gap:8px; margin-bottom:10px; }
    .api-key-input { flex:1; }

    .button-group { display:flex; gap:8px; }
    
    .error-box { background:rgba(255,0,0,0.06); padding:10px; border-radius:8px; color:#ffb4b4; margin-bottom:8px; }
    .placeholder-text { color:var(--muted); }

    @media (max-width:940px){
      body { padding: 14px; }
      .app{grid-template-columns:1fr; width:100%;}
    }
  </style>
</head>
<body>
  <div class="app" id="app"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // --- Configuration ---
    const CONFIG = {
      languageOptions: ["Turkish","Nordic","Latin","Celtic","Slavic","Japanese","Greek","Hebrew"],
      styleOptions: ["Poetic","Mythic","Minimalistic","Modern","Archaic","Heroic"],
      themeOptions: ["Cosmic","Nature","Fire","Water","Folklore","Music","Animals","Balance"],
      blacklist: ["tuna","dudu","puff","poop","dork","shit","fuck"],
      buildGeminiPrompt: (languages, style, theme) => {
        const langs = (languages && languages.length) ? languages.join(", ") : "Any";
        return `Generate a JSON array of unique, plausible names based on these inputs:
        - Origins: ${langs}
        - Style: ${style}
        - Theme: ${theme}
        Each object must have "name" (string), "meaning" (string), and "roots" (array of objects with "origin", "root", "gloss"). Return at least 20 for filtering.`;
      }
    };

    // --- Helper Functions ---
    function sanitizeAndScore(items){
        const lowered = new Set();
        const out = [];
        for (const it of (items || [])) {
          if (!it || !it.name) continue;
          const name = String(it.name).trim();
          const nameLower = name.toLowerCase();
          if (!/^[A-Za-z\-]{3,12}$/.test(name)) continue;
          if (CONFIG.blacklist.some(b => nameLower.includes(b))) continue;
          if (lowered.has(nameLower)) continue;
          if (name.length < 4 || name.length > 10) continue;
          const syllables = (nameLower.match(/[aeiouy]+/g) || []).length;
          const score = (5 - Math.abs(syllables - 2)) + (10 - Math.min(8, name.length))/2;
          lowered.add(nameLower);
          out.push({...it, score: Math.round(score*10)/10});
        }
        out.sort((a,b)=> (b.score||0) - (a.score||0));
        return out;
    }
    
    function robustParseJSON(text){
        if (!text) return [];
        try {
            const parsed = JSON.parse(text);
            if (Array.isArray(parsed)) return parsed;
        } catch (e) {
            console.error("Failed to parse JSON, attempting fallback extraction.", e);
            const start = text.indexOf('[');
            const end = text.lastIndexOf(']');
            if (start !== -1 && end !== -1 && end > start) {
                const substring = text.substring(start, end + 1);
                try {
                    const parsedSubstring = JSON.parse(substring);
                    if (Array.isArray(parsedSubstring)) return parsedSubstring;
                } catch (subError) {
                    console.error("Fallback JSON parsing also failed.", subError);
                }
            }
        }
        return [];
    }
    
    async function callGemini(prompt, key) {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-preview-05-20:generateContent?key=${encodeURIComponent(key.trim())}`;
        const body = {
          contents: [{ parts: [{ text: prompt }] }],
          generationConfig: { responseMimeType: "application/json" }
        };

        const resp = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });
        if (!resp.ok) {
          const errText = await resp.text();
          throw new Error(`${resp.status} ${errText}`);
        }
        const data = await resp.json();
        const textOutput = data && data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0] && data.candidates[0].content.parts[0].text;
        if (!textOutput) {
            throw new Error("Received an empty or invalid response from the API.");
        }
        return textOutput;
    }

    // --- Components ---
    const Controls = ({ apiKey, setApiKey, languages, setLanguages, style, setStyle, theme, setTheme, count, setCount, onGenerate, onReset, loading }) => {
        const toggleLanguage = (lang) => {
            setLanguages(prev => prev.includes(lang) ? prev.filter(l => l !== lang) : [...prev, lang]);
        };

        return (
            <div className="controls">
                <div className="hdr">
                    <div className="logo">CC</div>
                    <div className="hdr-text">
                        <h1>Cultural Coinage</h1>
                        <p className="desc">Blend linguistic roots into original names.</p>
                    </div>
                </div>

                <div className="api-key-group">
                    <input className="api-key-input" placeholder="Paste Gemini API Key" type="password" value={apiKey} onChange={e => setApiKey(e.target.value)} />
                    <button className="ghost" onClick={() => window.open('https://aistudio.google.com/app/apikey', '_blank')}>Help</button>
                </div>

                <div className="field">
                    <label>Language Origins</label>
                    <div className="multi-checkbox">
                        {CONFIG.languageOptions.map(l => (
                            <div key={l} className={`chip ${languages.includes(l) ? "active" : ""}`} onClick={() => toggleLanguage(l)}>{l}</div>
                        ))}
                    </div>
                    <div className="tiny">Tip: choose 1–3 origins for best blend quality.</div>
                </div>

                <div className="field">
                    <label>Style</label>
                    <select value={style} onChange={e => setStyle(e.target.value)}>
                        {CONFIG.styleOptions.map(s => <option key={s} value={s}>{s}</option>)}
                    </select>
                </div>

                <div className="field">
                    <label>Theme</label>
                    <select value={theme} onChange={e => setTheme(e.target.value)}>
                        {CONFIG.themeOptions.map(t => <option key={t} value={t}>{t}</option>)}
                    </select>
                </div>

                <div className="field">
                    <label>How many names?</label>
                    <input type="number" min="1" max="40" value={count} onChange={e => setCount(parseInt(e.target.value || 1))} />
                </div>

                <div className="button-group">
                    <button className="primary" onClick={onGenerate} disabled={loading}>{loading ? "Generating..." : "Generate Names"}</button>
                    <button className="ghost" onClick={onReset}>Reset</button>
                </div>
            </div>
        );
    };

    const Results = ({ results, error, loading }) => {
        const copyToClipboard = (text) => {
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
        };
        
        return (
            <div className="results">
                <div className="topbar">
                    <div>
                        <span className="topbar-title">Results</span>
                        <span className="topbar-count"> — {results.length} name(s)</span>
                    </div>
                </div>

                {error && <div className="error-box">{error}</div>}

                {results.length === 0 && !loading && <div className="placeholder-text">No names yet. Select options and click Generate.</div>}
                {loading && results.length === 0 && <div className="placeholder-text">Generating...</div>}

                {results.map((r, idx) => (
                    <div className="name-card" key={r.name + idx}>
                        <div className="name-left">
                            <div className="name-title">{r.name} <span className="name-sub name-score">• {r.score || ""}</span></div>
                            <div className="name-sub">{r.meaning || "(no meaning provided)"}</div>
                            <div className="name-roots">{(r.roots || []).map(x => `${x.root} (${x.origin})`).join(" · ")}</div>
                        </div>
                        <div className="name-right">
                            <button className="ghost" onClick={() => copyToClipboard(r.name)}>Copy</button>
                        </div>
                    </div>
                ))}
            </div>
        );
    };

    // --- Main App Component ---
    function App() {
      const [apiKey, setApiKey] = useState("");
      const [languages, setLanguages] = useState(["Turkish", "Nordic"]);
      const [style, setStyle] = useState("Poetic");
      const [theme, setTheme] = useState("Cosmic");
      const [count, setCount] = useState(8);
      const [results, setResults] = useState([]);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState("");

      const handleFriendlyError = (err, context) => {
          console.error(`Error during ${context}:`, err);
          if (err.message.includes("400")) {
              setError(`API Error: Invalid API Key. Please check your key and try again.`);
          } else {
              setError(`An error occurred while ${context}. Please try again.`);
          }
      };

      const generate = async () => {
        setError("");
        if (!apiKey) { setError("Please paste your Gemini API Key."); return; }
        if (!languages.length) { setError("Please select at least one language origin."); return; }
        setLoading(true);
        setResults([]);
        try {
          const prompt = CONFIG.buildGeminiPrompt(languages, style, theme);
          const raw = await callGemini(prompt, apiKey);
          const parsed = robustParseJSON(raw);
          const sanitized = sanitizeAndScore(parsed);
          setResults(sanitized.slice(0, count));
        } catch (err) {
          handleFriendlyError(err, "generating names");
        } finally {
          setLoading(false);
        }
      };
      
      const reset = () => {
          setResults([]);
          setError("");
      };

      return (
        <React.Fragment>
          <Controls 
            apiKey={apiKey} setApiKey={setApiKey}
            languages={languages} setLanguages={setLanguages}
            style={style} setStyle={setStyle}
            theme={theme} setTheme={setTheme}
            count={count} setCount={setCount}
            onGenerate={generate} onReset={reset} loading={loading}
          />
          <Results 
            results={results}
            error={error}
            loading={loading}
          />
        </React.Fragment>
      );
    }

    ReactDOM.createRoot(document.getElementById('app')).render(<App />);
  </script>
</body>
</html>

