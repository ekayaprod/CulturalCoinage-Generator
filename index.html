<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cultural Coinage Generator</title>

    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; color: #d1d5db; margin: 0; padding: 0; }
        .scrolling-panel::-webkit-scrollbar { width: 8px; }
        .scrolling-panel::-webkit-scrollbar-track { background: transparent; }
        .scrolling-panel::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
    </style>
</head>

<body>
    <div id="root"></div>

    <script>
        // --- CONFIGURATION & DATA ---
        const themeOptions = ["Nature", "Cosmic", "Balance", "Strength", "Water", "Light", "Shadow", "Music"];
        const styleOptions = ["Lyrical & Melodic", "Archaic & Mythic", "Minimalist & Modern", "Heroic & Resonant"];

        // --- APP STATE ---
        let appState = {
            apiKey: '',
            isLoading: false,
            error: null,
            generatedPrompt: null,
            selectedLanguages: ["Celtic", "Sanskrit"],
            selectedThemes: ["Light", "Balance"],
            selectedStyle: "Lyrical & Melodic"
        };

        // --- CACHED DOM ELEMENTS ---
        let dom_root, dom_main, dom_controls_container;

        // --- UTILITY & DOM FUNCTIONS ---
        function createSystemPrompt(taskPrompt) {
            return `You are an expert in cultural linguistics. ${taskPrompt}`;
        }

        function createElement(tag, classes = '', attributes = {}) {
            const el = document.createElement(tag);
            if (classes) el.className = classes;
            Object.entries(attributes).forEach(([key, value]) => el.setAttribute(key, value));
            return el;
        }

        function clearElement(element) {
            if(element) element.innerHTML = '';
        }
        
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        /**
         * CONSOLIDATION FIX: This new helper function creates a labeled form control,
         * eliminating repetitive code from the initializeApp function.
         */
        function createFormControl(config) {
            const container = createElement('div');
            const label = createElement('label', 'block text-sm font-medium text-gray-300 mb-2');
            label.textContent = config.label;
            label.setAttribute('for', config.id);
            
            let control;
            if (config.type === 'select') {
                control = createElement('select', 'w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-white', { id: config.id });
                if (config.multiple) {
                    control.setAttribute('multiple', true);
                    control.classList.add('h-24');
                }
                config.options.forEach(optValue => {
                    const option = createElement('option');
                    option.value = optValue;
                    option.textContent = optValue;
                    if (config.multiple ? config.value.includes(optValue) : config.value === optValue) {
                        option.selected = true;
                    }
                    control.appendChild(option);
                });
            } else {
                control = createElement('input', 'w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-white', {
                    id: config.id,
                    type: config.type,
                    placeholder: config.placeholder || ''
                });
                control.value = Array.isArray(config.value) ? config.value.join(', ') : config.value;
            }

            control.addEventListener(config.eventType || 'input', config.handler);
            container.append(label, control);
            return container;
        }

        // --- DYNAMIC UI UPDATERS ---
        function updateMainContent() {
            clearElement(dom_main);
            // ... (rest of updateMainContent logic remains the same)
        }

        // --- STATE & EVENT HANDLERS ---
        function updateState(key, value) {
            appState[key] = value;
        }

        function toggleControls() {
            dom_controls_container.classList.toggle('hidden');
        }

        function handleGenerate() {
            const task = `Generate culturally inspired names based on languages: ${appState.selectedLanguages.join(', ')}, themes: ${appState.selectedThemes.join(', ')}, and style: ${appState.selectedStyle}.`;
            appState.generatedPrompt = createSystemPrompt(task);
            appState.isLoading = false; 
            appState.error = null;
            updateMainContent();
        }

        // --- APP INITIALIZATION ---
        function initializeApp() {
            dom_root = document.getElementById('root');
            clearElement(dom_root);
            
            const container = createElement('div', 'bg-gray-900 w-full min-h-screen flex flex-col');
            // ... (Header and FAB creation remains the same) ...

            dom_main = createElement('main', 'flex-grow p-3 md:p-6 overflow-y-auto', { id: 'main-content' });
            
            // --- CONSOLIDATION FIX START ---
            // Drawer creation is now cleaner, using the new helper function.
            dom_controls_container = createElement('div', 'hidden', { id: 'controls-drawer-container' });
            const backdrop = createElement('div', 'fixed inset-0 bg-black/60 z-40');
            backdrop.addEventListener('click', toggleControls);
            const drawer = createElement('div', 'fixed top-0 left-0 h-full w-full max-w-xs sm:max-w-sm bg-gray-900 border-r border-gray-700 z-50 transform transition-transform');
            const drawerContent = createElement('div', 'flex flex-col h-full p-4 overflow-y-auto');
            
            const drawerHeader = createElement('div', 'flex items-center justify-between mb-6');
            const drawerTitle = createElement('h2', 'text-xl font-bold text-white');
            drawerTitle.textContent = 'Controls';
            const closeBtn = createElement('button', 'text-gray-400 hover:text-white text-2xl');
            closeBtn.innerHTML = '&times;';
            closeBtn.addEventListener('click', toggleControls);
            drawerHeader.append(drawerTitle, closeBtn);

            const formContainer = createElement('div', 'space-y-4');

            // API Key Control
            formContainer.appendChild(createFormControl({
                label: 'API Key', id: 'apiKeyInput', type: 'password',
                value: appState.apiKey, placeholder: 'Enter Gemini API key',
                handler: debounce((e) => updateState('apiKey', e.target.value), 300)
            }));

            // Languages Control
            formContainer.appendChild(createFormControl({
                label: 'Languages', id: 'languageInput', type: 'text',
                value: appState.selectedLanguages, placeholder: 'Celtic, Sanskrit',
                handler: debounce((e) => updateState('selectedLanguages', e.target.value.split(',').map(s => s.trim()).filter(Boolean)), 300)
            }));

            // Themes Control
            formContainer.appendChild(createFormControl({
                label: 'Themes', id: 'themeSelect', type: 'select',
                value: appState.selectedThemes, options: themeOptions, multiple: true, eventType: 'change',
                handler: (e) => updateState('selectedThemes', Array.from(e.target.selectedOptions).map(opt => opt.value))
            }));
            
            // Style Control
            formContainer.appendChild(createFormControl({
                label: 'Style', id: 'styleSelect', type: 'select',
                value: appState.selectedStyle, options: styleOptions, eventType: 'change',
                handler: (e) => updateState('selectedStyle', e.target.value)
            }));

            drawerContent.append(drawerHeader, formContainer);
            drawer.appendChild(drawerContent);
            dom_controls_container.append(backdrop, drawer);
            // --- CONSOLIDATION FIX END ---

            const header = createElement('div', 'w-full bg-gray-900/80 backdrop-blur-sm border-b border-gray-700 p-4 flex items-center justify-between sticky top-0 z-20');
            const title = createElement('h1', 'text-lg font-bold text-white');
            title.textContent = 'Cultural Coinage Generator';
            const settingsBtn = createElement('button', 'text-gray-300 hover:text-white p-2 rounded-full -mr-2');
            settingsBtn.innerHTML = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.096 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>';
            settingsBtn.addEventListener('click', toggleControls);
            header.append(title, settingsBtn);

            const fabContainer = createElement('div', 'fixed bottom-4 right-4 z-10 flex flex-col items-end gap-3');
            const generateBtn = createElement('button', 'bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-full shadow-lg flex items-center gap-2 transition-colors min-h-12 min-w-12 justify-center');
            generateBtn.innerHTML = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg><span class="hidden sm:inline">Generate</span>';
            generateBtn.addEventListener('click', handleGenerate);
            fabContainer.appendChild(generateBtn);

            container.append(header, dom_main, fabContainer, dom_controls_container);
            dom_root.appendChild(container);

            updateMainContent();
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>


         * This project is about inventing new names that blend cultural and linguistic origins 
         * with thematic inspiration. The agent acts as an expert scholar to provide 
         * context-aware, poetic suggestions, learning from user feedback.
         */
        const { useState, useEffect, useRef } = React;
        
        // --- 1. CONFIGURATION & DATA ---
        const API_BASE_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-preview-05-20:generateContent";
        const themeOptions = ["Nature", "Cosmic", "Balance", "Strength", "Water", "Light", "Shadow", "Music"];
        const styleOptions = ["Lyrical & Melodic", "Archaic & Mythic", "Minimalist & Modern", "Heroic & Resonant"];
        const blacklist = ["tuna", "ilay", "baran", "nur", "solren", "kuzel", "anal"];

        // --- 2. CORE LOGIC & PROMPTING ---
        const createSystemPrompt = (taskPrompt) => { /* ... createSystemPrompt logic ... */ return `...`; };
        const getSyllableCount = (word) => { /* ... syllable counting logic ... */ return 1; };
        const parseAndProcessResponse = (responseText) => { /* ... parsing and scoring logic ... */ return []; };

        // --- 3. UI COMPONENTS ---
        const PhilosophyModal = ({ onClose }) => ( /* ... Modal Component ... */ );
        const NameCard = ({ item, onLike, isLiked }) => ( /* ... Name Card Component ... */ );

        const PromptDisplayCard = ({ prompt }) => {
            const [copied, setCopied] = useState(false);
            const handleCopy = () => {
                navigator.clipboard.writeText(prompt);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };
            return (
                <div className="bg-gray-800 border border-gray-700 rounded-lg p-4 h-full flex flex-col">
                    <div className="flex justify-between items-center mb-2">
                        <h3 className="text-lg font-bold text-white">Generated Prompt</h3>
                        <button onClick={handleCopy} className="text-sm bg-blue-600 text-white font-semibold px-3 py-1 rounded-md hover:bg-blue-700">
                            {copied ? 'Copied!' : 'Copy Prompt'}
                        </button>
                    </div>
                    <p className="text-xs text-gray-400 mb-4">No API key found. Copy this prompt and paste it into your preferred LLM.</p>
                    <pre className="text-sm text-gray-300 bg-gray-900 rounded-md p-4 overflow-auto whitespace-pre-wrap flex-grow">
                        {prompt}
                    </pre>
                </div>
            );
        };
        
        // --- 4. MAIN APPLICATION ---
        function App() {
            // State initialization from Local Storage
            const getInitialState = (key, defaultValue) => { /* ... getInitialState logic ... */ return defaultValue; };
            
            const [apiKey, setApiKey] = useState(() => getInitialState('apiKey', ''));
            const [results, setResults] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);
            const [showPhilosophy, setShowPhilosophy] = useState(false);
            const [likedNames, setLikedNames] = useState(() => getInitialState('likedNames', []));
            const [generatedPrompt, setGeneratedPrompt] = useState(null); // New state for no-API-key mode

            // ... other state variables and useEffect for saving state ...

            const handleLike = (nameObject) => { /* ... handleLike logic ... */ };
            const handleAddLanguage = () => { /* ... language add logic ... */ };
            const handleRemoveLanguage = (langToRemove) => { /* ... language remove logic ... */ };

            const executePrompt = async (prompt) => {
                setIsLoading(true);
                setError(null);
                setResults([]);
                setGeneratedPrompt(null);

                // --- DUAL MODE LOGIC ---
                if (!apiKey) {
                    setGeneratedPrompt(prompt);
                    setIsLoading(false);
                    return;
                }

                // API Mode (existing logic)
                try {
                    // ... API call and retry logic ...
                } catch (err) {
                    // ... error handling ...
                } finally {
                    setIsLoading(false);
                }
            };

            const handleGenerateFirstNames = () => {
                let task;
                // ... logic to build the first name prompt task ...
                executePrompt(createSystemPrompt(task));
            };

            const handleSuggestMiddleNames = () => {
                // ... logic to build the middle name prompt task ...
                executePrompt(createSystemPrompt(task));
            };

            return (
                <>
                    {showPhilosophy && <PhilosophyModal onClose={() => setShowPhilosophy(false)} />}
                    <div className="min-h-screen w-full flex flex-col md:flex-row">
                        {/* Left Panel: Controls */}
                        <div className="w-full md:w-1/3 md:max-w-md h-auto md:h-screen flex flex-col p-4 md:p-6 bg-gray-900 border-b md:border-b-0 md:border-r border-gray-700 overflow-y-auto scrolling-panel">
                            {/* ... Header and other controls ... */}
                            <div className="mt-6">
                                <div className="space-y-2">
                                    <button onClick={handleGenerateFirstNames} disabled={isLoading} className="w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 disabled:bg-blue-400">
                                        {isLoading ? 'Consulting...' : (apiKey ? (likedNames.length > 0 ? 'Riff on Liked Names' : 'Generate First Names') : 'Generate Prompt for First Names')}
                                    </button>
                                     <button onClick={handleSuggestMiddleNames} disabled={isLoading} className="w-full bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-gray-700 disabled:bg-gray-400 text-sm">
                                        {isLoading ? 'Consulting...' : (apiKey ? 'Suggest Middle Names' : 'Generate Prompt for Middle Names')}
                                    </button>
                                </div>
                                <button onClick={() => setShowPhilosophy(true)} className="text-sm text-gray-400 hover:text-white text-center w-full mt-4">Show Philosophy</button>
                            </div>
                        </div>

                        {/* Right Panel: Conditional Results Display */}
                        <div className="w-full md:w-2/3 flex-grow p-4 md:p-6 scrolling-panel overflow-y-auto">
                            {isLoading && <div className="flex h-full items-center justify-center text-center">Consulting the agent...</div>}
                            {error && <div className="flex h-full items-center justify-center text-center text-red-400 bg-red-900/50 p-4 rounded-md">{error}</div>}
                            
                            {!isLoading && !error && (
                                <>
                                    {generatedPrompt && <PromptDisplayCard prompt={generatedPrompt} />}
                                    
                                    {results.length > 0 && (
                                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {results.map(item => (
                                                <NameCard 
                                                    key={item.name} 
                                                    item={item} 
                                                    onLike={handleLike} 
                                                    isLiked={likedNames.some(n => n.name === item.name)} 
                                                />
                                            ))}
                                        </div>
                                    )}

                                    {!generatedPrompt && results.length === 0 && (
                                        <div className="flex h-full items-center justify-center text-center text-gray-500">
                                            <p>Your culturally coined names will appear here.</p>
                                        </div>
                                    )}
                                </>
                            )}
                        </div>
                    </div>
                </>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>


